<h1 class="title">Warcdealer</h1>

<p class="breadcrumbs">Page location:
    <span><a href="/ancillary/ready-to-use.htm">Software</a></span>
</p>

<p>Warcdealer is an app that uploads Web archive files to the Internet Archive.</p>
<p>It is available <a href="https://github.com/ethus3h/ember/tree/master/ember-satellite-projects/warcdealer">at GitHub</a>.</p>
<p>It can be used with <a href="https://github.com/ludios/grab-site/">grab-site</a> for a complete on-demand Web archival system.</p>
<h2>Usage</h2>
<p><span class="hatnote-emphasis-warning">Before running Warcdealer, <code>cd</code> to the directory that contains or will contain the files you would like uploaded. Note that those should be the only files present in that directory.</span></p>
<figure class="center-figure app-syntax">
    <code>warcdealer</code>
</figure>

<h2>Installation</h2>

<ol>
    <li>Ensure your system has the correct dependencies:
        <ul>
            <li>Only tested and supported using GNU/Linux operating systems. It may be possible to run Warcdealer using other UNIX-like operating systems, but that is not currently supported.</li>
            <li>Requires a connection to the World Wide Web able to access the <a href="https://archive.org/">Internet Archive</a>, and <a href="https://github.com/">GitHub</a> for installation and updates.</li>
            <li>Requires ia (https://pypi.python.org/pypi/internetarchive) to be installed and to have been configured since being updated to version 1.0.2.</li>
            <li>hashdeep (probably provided in the md5deep package for your system).</li>
            <li>Python 2, runnable as <code>python2</code>.</li>
            <li>Git (for installing and updating).</li>
            <li>Optionally, Warcdealer can be used with <a href="https://github.com/ludios/grab-site/">grab-site</a>.</li>
        </ul>
        Needed for the optional archive index viewer:
        <ul>
            <li>Git</li>
            <li>Python 3, runnable as <code>python3</code></li>
            <li>Tornado</li>
            <li>python-dateutil</li>
        </ul>
    </li>
    <li>If you have a version of Warcdealer prior to version 3 installed, remove it.</li>
    <li>Figure out as what user Warcdealer should run. If you're using grab-site, this is either the user as which grab-site is running, or <code>root</code>. Otherwise, this is any user with write permission for the files you would like to upload. (<code>root</code> will work in either case.) When you have selected the correct user, substitute it in place of "<code>userName</code>" in the following command, and run the resulting command (note that output beginning with "<code>mv: cannot stat</code>" can be safely ignored):<br /><pre><code>mv ~/.warcdealer.cfg ~/.warcdealer.bak; echo "userName" > ~/.warcdealer.cfg</code></pre></li>
    <li>Decide at what threshold of free disk space, in gigabytes, you would like uploads to begin. A reasonable default for large disks is "<code>80</code>". When you have decided this, substitute that number in place of "<code>diskThreshold</code>" in the following command, and run the resulting command:<br /><pre><code>echo "diskThreshold" >> ~/.warcdealer.cfg</code></pre></li>
    <li>Figure out what partition you would like to monitor for free disk space (<span class="foreign-text">e. g.</span> <code>/</code> for the root partition). When you know this, substitute it in place of "<code>diskMonitorPartition</code>" in the following command, and run the resulting command:<br /><pre><code>echo "diskMonitorPartition" >> ~/.warcdealer.cfg</code></pre></li>
    <li>Decide how frequently, in seconds, you want the free disk space to be checked. A reasonable default is "<code>60</code>". When you have decided this, substitute it in place of "diskCheckInterval" in the following command, and run the resulting command:<br /><pre><code>echo "diskCheckInterval" >> ~/.warcdealer.cfg</code></pre></li>
    <li>Figure out to which collection at the Internet Archive you want to upload (upload permission to the collection is necessary). If you don't know otherwise, this should be "<code>opensource</code>". When you have figured this out, substitute it in place of "destinationCollection" in the following command, and run the resulting command:<br /><pre><code>echo "destinationCollection" >> ~/.warcdealer.cfg</code></pre></li>
    <li>If you want to disable the archive index feature, run the following command:<br /><pre><code>echo "disableArchiveIndex" >> ~/.warcdealer.cfg; set +H</code></pre><br />Otherwise, run the following command:<br /><pre><code>echo "enableArchiveIndex" >> ~/.warcdealer.cfg; set +H</code></pre></li>
    <li>As the user you chose in step 2, run the following command:<br /><!-- TODO: update the line of the config file to look for the UUID in --><pre><code>echo "enableWARCBundling" >> ~/.warcdealer.cfg; warcdealerInstallationUUID=$(python2 -c 'import uuid; print str(uuid.uuid4())'); oldWarcdealerInstallationUUID=$(sed '7q;d' "$HOME"/.warcdealer.cfg); warcdealerUUIDRegex='^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$'; if [[ $oldWarcdealerInstallationUUID =~ $warcdealerUUIDRegex ]]; then warcdealerInstallationUUID="$oldWarcdealerInstallationUUID"; fi; cd ~; mkdir "$warcdealerInstallationUUID"; cd "$warcdealerInstallationUUID"; git clone https://github.com/ethus3h/ember.git; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer ~/.warcdealer; chmod +x ~/.warcdealer; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer-ia-upload ~/.warcdealer-ia-upload; chmod +x ~/.warcdealer-ia-upload; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer-ia-upload-split ~/.warcdealer-ia-upload-split; chmod +x ~/.warcdealer-ia-upload-split; cp -f ./ember/ember-satellite-projects/warcdealer/viewer.patch ~/.warcdealer-viewer.patch; echo $(date +%Y-%m-%d-%H-%M-%S-%N)-$(xxd -pu &lt;&lt;&lt; "$(date +%z)") >> ~/.warcdealer.cfg; echo "$warcdealerInstallationUUID" >> ~/.warcdealer.cfg; cat ./ember/ember-satellite-projects/warcdealer/profile.append >> ~/.bash_profile; echo "#"'!'"/bin/bash" >> ~/.bashrc; echo ". ~/.bash_profile" >> ~/.bashrc; chmod +x ~/.bash_profile; chmod +x ~/.bashrc</code></pre></li>
    <li>Log out and log in again, to update your shell aliases.</li>
</ol>

<h2>Updating</h2>
<ol>
    <li>Check for changes to the requirements.</li>
    <li>Check the Warcdealer version. If the major version has changed, or <a href="release-notes.htm">the release notes</a> specify that it should be reinstalled since the version you have installed, (the part before the first "." in the version number), follow the current installation instructions instead (unless you know you don't need to, <span class="foreign-text">e. g.</span> if the release notes specify that the configuration file format is compatible with the major version you have installed).</li>
    <li>As the user you chose in step 2 of the installation process, run the following command:<br /><pre><code>warcdealerTemporaryUUID=$(python2 -c 'import uuid; print str(uuid.uuid4())'); cd ~; mkdir "$warcdealerTemporaryUUID"; cd "$warcdealerTemporaryUUID"; git clone https://github.com/ethus3h/ember.git; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer ~/.warcdealer; chmod +x ~/.warcdealer; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer-ia-upload ~/.warcdealer-ia-upload; chmod +x ~/.warcdealer-ia-upload; cp -f ./ember/ember-satellite-projects/warcdealer/warcdealer-ia-upload-split ~/.warcdealer-ia-upload-split; chmod +x ~/.warcdealer-ia-upload-split; cp -f ./ember/ember-satellite-projects/warcdealer/viewer.patch ~/.warcdealer-viewer.patch;</code></pre></li>
</ol>

<h2>Release notes</h2>
<p>See <a href="release-notes.htm">the dedicated page</a>.</p>

<h2>Configuration file format</h2>
<p><span class="hatnote-emphasis-warning">Be careful when manually editing the configuration file. Specifically, do <b>NOT</b> use the "<code>disableWARCBundling</code>" option unless you know what you are doing.</span></p>
<p>The configuration file is located at <code>~/.warcdealer.cfg</code>. It contains configuration values separated by a line feed (0x0A), as follows:</p>
<ul>
    <li>Name of user as which Warcdealer should run</li>
    <li>Amount of free space in gigabytes below which WARC files should be uploaded and crawls should be paused</li>
    <li>Delay in seconds between disk space checks</li>
    <li>Internet Archive target collection identifier</li>
    <li>"<code>disableArchiveIndex</code>" to disable the archive search tool, or "<code>enableArchiveIndex</code>" to enable it (any other value will be treated as "<code>enableArchiveIndex</code>")</li>
    <li>"<code>disableWARCBundling</code>" to upload each file as a separate item, or "<code>enableWARCBundling</code>" to enable it (any other value will be treated as "<code>enableWARCBundling</code>")</li>
    <li>Installation time</li>
    <li>Installation UUID</li>
</ul>
<p>Note that there is currently no facility for storing configuration values containing line feeds.</p>
